% syms x y z P_0 k r
% 
% d = sqrt(x^2 + y^2 + z^2);
% sintheta = sqrt(x^2 + y^2)/d;
% 
% p = P_0*besselj(0,k*r*sintheta)/d*exp(1i*k*d);%Givet att transducern är i origo
% px = diff(p,x);
% py = diff(p,y);
% pz = diff(p,z);

p = @(x,y,z)(P_0.*exp(k.*(x.^2 + y.^2 + z.^2).^(1./2).*1i).*besselj(0, (k.*r.*(x.^2 + y.^2).^(1./2))./(x.^2 + y.^2 + z.^2).^(1./2)))./(x.^2 + y.^2 + z.^2).^(1./2);
px = @(x,y,z) - (P_0.*x.*exp(k.*(x.^2 + y.^2 + z.^2).^(1./2).*1i).*besselj(0, (k.*r.*(x.^2 + y.^2).^(1./2))./(x.^2 + y.^2 + z.^2).^(1./2)))./(x.^2 + y.^2 + z.^2).^(3./2) - (P_0.*exp(k.*(x.^2 + y.^2 + z.^2).^(1./2).*1i).*((k.*r.*x)./((x.^2 + y.^2).^(1./2).*(x.^2 + y.^2 + z.^2).^(1./2)) - (k.*r.*x.*(x.^2 + y.^2).^(1./2))./(x.^2 + y.^2 + z.^2).^(3./2)).*besselj(1, (k.*r.*(x.^2 + y.^2).^(1./2))./(x.^2 + y.^2 + z.^2).^(1./2)))./(x.^2 + y.^2 + z.^2).^(1./2) + (P_0.*k.*x.*exp(k.*(x.^2 + y.^2 + z.^2).^(1./2).*1i).*besselj(0, (k.*r.*(x.^2 + y.^2).^(1./2))./(x.^2 + y.^2 + z.^2).^(1./2)).*1i)./(x.^2 + y.^2 + z.^2);
py = @(x,y,z)- (P_0.*y.*exp(k.*(x.^2 + y.^2 + z.^2).^(1./2).*1i).*besselj(0, (k.*r.*(x.^2 + y.^2).^(1./2))./(x.^2 + y.^2 + z.^2).^(1./2)))./(x.^2 + y.^2 + z.^2).^(3./2) - (P_0.*exp(k.*(x.^2 + y.^2 + z.^2).^(1./2).*1i).*((k.*r.*y)./((x.^2 + y.^2).^(1./2).*(x.^2 + y.^2 + z.^2).^(1./2)) - (k.*r.*y.*(x.^2 + y.^2).^(1./2))./(x.^2 + y.^2 + z.^2).^(3./2)).*besselj(1, (k.*r.*(x.^2 + y.^2).^(1./2))./(x.^2 + y.^2 + z.^2).^(1./2)))./(x.^2 + y.^2 + z.^2).^(1./2) + (P_0.*k.*y.*exp(k.*(x.^2 + y.^2 + z.^2).^(1./2).*1i).*besselj(0, (k.*r.*(x.^2 + y.^2).^(1./2))./(x.^2 + y.^2 + z.^2).^(1./2)).*1i)./(x.^2 + y.^2 + z.^2);
pz = @(x,y,z)- (P_0.*z.*exp(k.*(x.^2 + y.^2 + z.^2).^(1./2).*1i).*besselj(0, (k.*r.*(x.^2 + y.^2).^(1./2))./(x.^2 + y.^2 + z.^2).^(1./2)))./(x.^2 + y.^2 + z.^2).^(3./2) + (P_0.*k.*z.*exp(k.*(x.^2 + y.^2 + z.^2).^(1./2).*1i).*besselj(0, (k.*r.*(x.^2 + y.^2).^(1./2))./(x.^2 + y.^2 + z.^2).^(1./2)).*1i)./(x.^2 + y.^2 + z.^2) + (P_0.*k.*r.*z.*exp(k.*(x.^2 + y.^2 + z.^2).^(1./2).*1i).*(x.^2 + y.^2).^(1./2).*besselj(1, (k.*r.*(x.^2 + y.^2).^(1./2))./(x.^2 + y.^2 + z.^2).^(1./2)))./(x.^2 + y.^2 + z.^2).^2;
